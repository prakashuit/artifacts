<?xml version="1.0" ?>
<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="Mozilla/5.0" version="22.1.0" type="device">
  <diagram id="option-c-sequence" name="Option C - Sequence">
    <mxGraphModel dx="1434" dy="790" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1600" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="2" value="Option C: BFF Pattern - Authentication &amp;amp; API Call Flow" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="800" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="3" value="User
Browser" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="100" y="80" width="100" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="3_lifeline" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" edge="1" parent="1" source="3">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="150" y="1550" as="targetPoint"/>
        </mxCell>
        <mxCell id="4" value="ALB" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="280" y="80" width="100" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="4_lifeline" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" edge="1" parent="1" source="4">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="330" y="1550" as="targetPoint"/>
        </mxCell>
        <mxCell id="5" value="BFF
(Node.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="460" y="80" width="100" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="5_lifeline" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" edge="1" parent="1" source="5">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="1550" as="targetPoint"/>
        </mxCell>
        <mxCell id="6" value="Session
Store" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="640" y="80" width="100" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="6_lifeline" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" edge="1" parent="1" source="6">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="690" y="1550" as="targetPoint"/>
        </mxCell>
        <mxCell id="7" value="Entra ID" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="820" y="80" width="100" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="7_lifeline" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" edge="1" parent="1" source="7">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="870" y="1550" as="targetPoint"/>
        </mxCell>
        <mxCell id="8" value="FastAPI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1000" y="80" width="100" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="8_lifeline" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" edge="1" parent="1" source="8">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="1050" y="1550" as="targetPoint"/>
        </mxCell>
        <mxCell id="9" value="React SPA
(Static)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1180" y="80" width="100" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="9_lifeline" value="" style="endArrow=none;dashed=1;html=1;rounded=0;" edge="1" parent="1" source="9">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="1230" y="1550" as="targetPoint"/>
        </mxCell>
        <mxCell id="100" value="PHASE 1: Initial Authentication (First Visit)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="50" y="180" width="1280" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="200" value="1. GET https://app.example.com" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="150" y="240" as="sourcePoint"/>
          <mxPoint x="330" y="240" as="targetPoint"/>
        </mxCell>
        <mxCell id="201" value="2. Forward request" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="330" y="280" as="sourcePoint"/>
          <mxPoint x="510" y="280" as="targetPoint"/>
        </mxCell>
        <mxCell id="202" value="3. Check session cookie
(not found)" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;dashed=1;curved=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="320" as="sourcePoint"/>
          <mxPoint x="610" y="320" as="targetPoint"/>
        </mxCell>
        <mxCell id="203" value="4. Redirect to Entra ID
authorize endpoint" style="endArrow=classic;html=1;rounded=0;strokeColor=#d79b00;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="370" as="sourcePoint"/>
          <mxPoint x="870" y="370" as="targetPoint"/>
        </mxCell>
        <mxCell id="204" value="5. Redirect to login page" style="endArrow=classic;html=1;rounded=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="870" y="410" as="sourcePoint"/>
          <mxPoint x="150" y="410" as="targetPoint"/>
        </mxCell>
        <mxCell id="205" value="6. User enters credentials" style="endArrow=classic;html=1;rounded=0;strokeColor=#d79b00;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="150" y="450" as="sourcePoint"/>
          <mxPoint x="870" y="450" as="targetPoint"/>
        </mxCell>
        <mxCell id="206" value="7. Redirect with auth code" style="endArrow=classic;html=1;rounded=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="870" y="490" as="sourcePoint"/>
          <mxPoint x="150" y="490" as="targetPoint"/>
        </mxCell>
        <mxCell id="207" value="8. Callback with auth code" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="150" y="530" as="sourcePoint"/>
          <mxPoint x="330" y="530" as="targetPoint"/>
        </mxCell>
        <mxCell id="208" value="9. Forward callback" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="330" y="570" as="sourcePoint"/>
          <mxPoint x="510" y="570" as="targetPoint"/>
        </mxCell>
        <mxCell id="209" value="10. Exchange code for tokens
(confidential client)" style="endArrow=classic;html=1;rounded=0;strokeColor=#d79b00;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="610" as="sourcePoint"/>
          <mxPoint x="870" y="610" as="targetPoint"/>
        </mxCell>
        <mxCell id="210" value="11. Return tokens:
- ID token
- Access token
- Refresh token" style="endArrow=classic;html=1;rounded=0;strokeColor=#d79b00;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="870" y="650" as="sourcePoint"/>
          <mxPoint x="510" y="650" as="targetPoint"/>
        </mxCell>
        <mxCell id="211" value="12. Store tokens in session store
with session ID" style="endArrow=classic;html=1;rounded=0;strokeColor=#b85450;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="700" as="sourcePoint"/>
          <mxPoint x="690" y="700" as="targetPoint"/>
        </mxCell>
        <mxCell id="212" value="13. Confirm stored" style="endArrow=classic;html=1;rounded=0;strokeColor=#b85450;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="690" y="740" as="sourcePoint"/>
          <mxPoint x="510" y="740" as="targetPoint"/>
        </mxCell>
        <mxCell id="213" value="14. Create HTTP-only
session cookie" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;dashed=1;curved=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="780" as="sourcePoint"/>
          <mxPoint x="610" y="780" as="targetPoint"/>
        </mxCell>
        <mxCell id="214" value="15. Serve React SPA
static files" style="endArrow=classic;html=1;rounded=0;strokeColor=#82b366;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="830" as="sourcePoint"/>
          <mxPoint x="1230" y="830" as="targetPoint"/>
        </mxCell>
        <mxCell id="215" value="16. Return SPA HTML/JS" style="endArrow=classic;html=1;rounded=0;strokeColor=#82b366;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="1230" y="870" as="sourcePoint"/>
          <mxPoint x="510" y="870" as="targetPoint"/>
        </mxCell>
        <mxCell id="216" value="17. Response with
session cookie" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="910" as="sourcePoint"/>
          <mxPoint x="330" y="910" as="targetPoint"/>
        </mxCell>
        <mxCell id="217" value="18. Serve SPA +
set session cookie" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="330" y="950" as="sourcePoint"/>
          <mxPoint x="150" y="950" as="targetPoint"/>
        </mxCell>
        <mxCell id="101" value="PHASE 2: Subsequent Visit (With Valid Session)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="50" y="1000" width="1280" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="218" value="19. GET https://app.example.com
(with session cookie)" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="150" y="1060" as="sourcePoint"/>
          <mxPoint x="330" y="1060" as="targetPoint"/>
        </mxCell>
        <mxCell id="219" value="20. Forward with cookie" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="330" y="1100" as="sourcePoint"/>
          <mxPoint x="510" y="1100" as="targetPoint"/>
        </mxCell>
        <mxCell id="220" value="21. Validate session" style="endArrow=classic;html=1;rounded=0;strokeColor=#b85450;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="1140" as="sourcePoint"/>
          <mxPoint x="690" y="1140" as="targetPoint"/>
        </mxCell>
        <mxCell id="221" value="22. Session valid" style="endArrow=classic;html=1;rounded=0;strokeColor=#b85450;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="690" y="1180" as="sourcePoint"/>
          <mxPoint x="510" y="1180" as="targetPoint"/>
        </mxCell>
        <mxCell id="222" value="23. Serve React SPA" style="endArrow=classic;html=1;rounded=0;strokeColor=#82b366;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="1220" as="sourcePoint"/>
          <mxPoint x="1230" y="1220" as="targetPoint"/>
        </mxCell>
        <mxCell id="223" value="24. Return SPA" style="endArrow=classic;html=1;rounded=0;strokeColor=#82b366;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="1230" y="1260" as="sourcePoint"/>
          <mxPoint x="510" y="1260" as="targetPoint"/>
        </mxCell>
        <mxCell id="224" value="25. Serve SPA
(already authenticated)" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="1300" as="sourcePoint"/>
          <mxPoint x="150" y="1300" as="targetPoint"/>
        </mxCell>
        <mxCell id="102" value="PHASE 3: SPA Makes API Call (Proxied Through BFF)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="50" y="1350" width="1280" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="225" value="26. API call: GET /api/users
(with session cookie)" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="150" y="1410" as="sourcePoint"/>
          <mxPoint x="330" y="1410" as="targetPoint"/>
        </mxCell>
        <mxCell id="226" value="27. Forward to BFF" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="330" y="1450" as="sourcePoint"/>
          <mxPoint x="510" y="1450" as="targetPoint"/>
        </mxCell>
        <mxCell id="227" value="28. Get access token
from session" style="endArrow=classic;html=1;rounded=0;strokeColor=#b85450;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="1490" as="sourcePoint"/>
          <mxPoint x="690" y="1490" as="targetPoint"/>
        </mxCell>
        <mxCell id="228" value="29. Return access token" style="endArrow=classic;html=1;rounded=0;strokeColor=#b85450;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="690" y="1530" as="sourcePoint"/>
          <mxPoint x="510" y="1530" as="targetPoint"/>
        </mxCell>
        <mxCell id="229" value="30. Call FastAPI with
Authorization: Bearer &amp;lt;token&amp;gt;" style="endArrow=classic;html=1;rounded=0;strokeColor=#82b366;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="1570" as="sourcePoint"/>
          <mxPoint x="1050" y="1570" as="targetPoint"/>
        </mxCell>
        <mxCell id="230" value="31. Validate JWT token" style="endArrow=classic;html=1;rounded=0;strokeColor=#82b366;strokeWidth=2;dashed=1;curved=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="1050" y="1610" as="sourcePoint"/>
          <mxPoint x="1150" y="1610" as="targetPoint"/>
        </mxCell>
        <mxCell id="231" value="32. Return user data" style="endArrow=classic;html=1;rounded=0;strokeColor=#82b366;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="1050" y="1650" as="sourcePoint"/>
          <mxPoint x="510" y="1650" as="targetPoint"/>
        </mxCell>
        <mxCell id="232" value="33. Proxy response" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="510" y="1690" as="sourcePoint"/>
          <mxPoint x="330" y="1690" as="targetPoint"/>
        </mxCell>
        <mxCell id="233" value="34. Return API response" style="endArrow=classic;html=1;rounded=0;strokeColor=black;strokeWidth=2;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry"/>
          <mxPoint x="330" y="1730" as="sourcePoint"/>
          <mxPoint x="150" y="1730" as="targetPoint"/>
        </mxCell>
        <mxCell id="300" value="&amp;lt;b&amp;gt;Key Security Benefits:&amp;lt;/b&amp;gt;&amp;lt;br&amp;gt;• Tokens never exposed to browser&amp;lt;br&amp;gt;• No XSS risk for tokens&amp;lt;br&amp;gt;• HTTP-only cookies&amp;lt;br&amp;gt;• Server-side session management" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;size=20;" vertex="1" parent="1">
          <mxGeometry x="50" y="1800" width="300" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="301" value="&amp;lt;b&amp;gt;Trade-offs:&amp;lt;/b&amp;gt;&amp;lt;br&amp;gt;• Additional BFF service to maintain&amp;lt;br&amp;gt;• Extra network hop (latency)&amp;lt;br&amp;gt;• Session store dependency&amp;lt;br&amp;gt;• More complex architecture&amp;lt;br&amp;gt;• Postman needs separate flow" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#f8cecc;strokeColor=#b85450;align=left;verticalAlign=top;size=20;" vertex="1" parent="1">
          <mxGeometry x="400" y="1800" width="300" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="302" value="&amp;lt;b&amp;gt;BFF Responsibilities:&amp;lt;/b&amp;gt;&amp;lt;br&amp;gt;• OAuth 2.0 confidential client&amp;lt;br&amp;gt;• Token storage &amp;amp; refresh&amp;lt;br&amp;gt;• Session management&amp;lt;br&amp;gt;• Serve static SPA files&amp;lt;br&amp;gt;• Proxy API calls with tokens" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;size=20;" vertex="1" parent="1">
          <mxGeometry x="750" y="1800" width="300" height="120" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
